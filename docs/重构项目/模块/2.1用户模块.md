## 用户模块

### 1. 原型预览

![](http://easyun.oss-cn-shanghai.aliyuncs.com/aegicare/picture/1620805594795_%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210512154625.png)

### 2.表结构

![用户模块](http://easyun.oss-cn-shanghai.aliyuncs.com/aegicare/picture/1620400441083_%E7%94%A8%E6%88%B7%E7%BB%93%E6%9E%84.png)

### 3. 功能接口

约26个接口，涉及用户、检测者、医生、医院、机构、部门、登录等内容

#### 3.1 注册/登录，获取token

手机号为系统唯一性标识，基础信息全部在user表中，有是否员工标识

患者、医生、员工可以统一登录，不限于账号密码登录、手机验证码登录、微信公众号小程序登录等

默认所有用户都是患者用户，可以自己修改密码

员工，由系统管理员设定，改变员工标识，部门、角色等设置

医生，分为预备数据，正式数据两类，预备数据由两种数据源：爬虫抓取全国医生数据和销售录入，审核通过后，成为正式数据，进入ERP实际有效的医生

方式一：输入手机号，获取验证码，验证通过即可注册登录，不限于PC、H5、APP等平台

方式二：微信公众号、微信小程序，授权登录、授权获取手机号后，可直接登录，用手机号做区分，如果有异常的，手机号过期、换号等，联系管理员

##### 3.1.1 获取验证码

| 接口编号 | 接口名称  | 版本号 | 内容                               | 开发人 | 创建时间   | 更新时间   |
| -------- | --------- | ------ | ---------------------------------- | ------ | ---------- | ---------- |
| AEGI0001 | 注册/登录 | v1.0   | 完成基本登录注册功能，手机号码验证 | 李姜   | 2021/04/01 | 2021/04/21 |

**URL地址：**

```
/auth/getCaptcha
```

**请求：**

| 参数名称 | 数据类型 | 是否必填 | 参数描述       | 参数示例             | 备注     |
| -------- | -------- | -------- | -------------- | -------------------- | -------- |
| token    | string   | 是       | token 验证信息 | "faslkdff7923roujoi" | v1.2添加 |
| phone    | string   | 是       | 手机号，11位   | 13012345678          | v1.1     |



```json
{
    "phone":"13012345678"
}
```

**结果：**

成功返回：

```json
{
    "state":2000,
    "msg":"验证码发送成功！"
}
```

失败结果：

```json
{
    "state":4001,
    "msg":"验证码发送失败，请联系管理员，电话0755-88888888"
}
```



##### 3.1.2 提交登录

说明：此接口只提供验证码验证功能，验证失败，停留当前页面，验证通过，前端业务控制后续流程

**URL地址：**

```url
/auth/checkCaptcha
```

**请求：**

```json
{
	"phone":"13012345678",
    "code":1234
}
```

**结果：**

成功：

```json
{
    "state":2000,
    "msg":"验证通过",
    "data":{
        "userid":"534532",
        "username":"福克斯",
        "token":"alsjdfklasudoiu24"
    }
}
```

失败：

```json
{
    "state":4002,
    "msg":"您输入的验证码错误，请查证后重新输入"
}
```



#### 3.2 登录用户管理

##### 3.2.1 获取用户分页列表

说明：销售员，只能看到本人及下属的用户

URL地址

```url
/resources/user/list
```

请求：

```json
{
    "page":2,
    "size":20,
    "token":"424jasd8809423"
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
          'ap':'AP23350',
          'af':'AF23330',
          'name': '*佳豪',
          'gender': '男',
          'birth': '1995/12/12',
          'province': '广东',
          'city': '深圳',
          'county': '南山区',
          'address': '大冲城市花园',
          'referent': 'AP23333',
          'relation': '爸爸',
          'saler':'12312',
          'regtime': '2020/08/02 14:23:12',
          'is_contact': true,
          'remark': '',
        },
        {
          'ap':'AP23351',
          'af':'AF23330',
          'name': '*佳豪',
          'gender': '男',
          'birth': '1995/12/12',
          'province': '广东',
          'city': '深圳',
          'county': '南山区',
          'address': '大冲城市花园',
          'referent': 'AP23333',
          'relation': '爸爸',
          'saler':'12312',
          'regtime': '2020/08/02 14:23:12',
          'is_contact': true,
          'remark': '',
        },
    ]
}
```

失败：

```json
{
    "state":4005,
    "msg":"获取失败"
}
```



##### 3.2.2 添加用户信息



##### 3.2.3 修改用户信息



##### 3.2.4 删除用户信息



#### 3.3 员工管理

##### 3.3.1 设置为员工（入职）



##### 3.3.2 分配部门



##### 3.3.3 分配角色权限



##### 3.3.4 获取我的角色权限



#### 3.4 医生管理

##### 3.4.1 获取医生分页列表

URL地址：

```url
/resources/doctor/list
```

请求：

```json
{
    "token":"123erser234", // 必填
    "page":1, // 非必填，默认1
    "size":20, // 非必填，默认20
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
            "avatar":"",
            "brief":"",
            "code":"DT1026",
            "department_code":"",
            "department_name":"",
            "doctor_interest":"",
            "email":"",
            "expert":"",
            "flag":false,
            "handler_id":0,
            "handler_name":"",
            "hospital_code":"HP1009",
            "hospital_name":"",
            "id":6025,
            "label":"",
            "name":"朱峰",
            "papers":{

            },
            "phone":"",
            "score":0,
            "state":false,
            "tags":{

            },
            "title":"主治医师"
        },
        {
            "avatar":"",
            "brief":"",
            "code":"DT1040",
            "department_code":"",
            "department_name":"",
            "doctor_interest":"",
            "email":"",
            "expert":"",
            "flag":false,
            "handler_id":0,
            "handler_name":"",
            "hospital_code":"HP1011",
            "hospital_name":"",
            "id":6022,
            "label":"",
            "name":"戴启麟",
            "papers":{

            },
            "phone":"",
            "score":0,
            "state":false,
            "tags":{

            },
            "title":"主任医师"
        },
    ]
}
```

失败：

```json
{
    "state":4006,
    "msg":"失败"
}
```



##### 3.4.2 添加医生信息



##### 3.4.3 修改医生信息



##### 3.4.4 删除医生信息



#### 3.5 机构管理

##### 3.5.1 获取机构分页列表



##### 3.5.2 添加机构信息



##### 3.5.3 修改机构信息



##### 3.5.4 删除机构信息



#### 3.6 部门管理



##### 3.6.1 获取部门列表

（树形）



##### 3.6.2 添加部门



##### 3.6.3 修改部门信息



##### 3.6.4 删除部门信息



#### 3.7 检测者管理

##### 3.7.1 获取检测者分页列表



##### 3.7.2 添加检测者信息



##### 3.7.3 修改检测者信息



##### 3.7.4 删除检测者信息











